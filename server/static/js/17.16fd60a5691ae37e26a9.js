webpackJsonp([17],{Ye6n:function(e,s){},oisi:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var r=t("lC5x"),a=t.n(r),n=t("J0Oq"),o=t.n(n),i=t("L/hj"),l=t("RWF8"),c=t("Jxlu"),u={components:{GoogleRecaptcha:l.a,UserTable:c.a},data:function(){return{processing:!1,email:null,sentCount:0,token:this.$route.query.token,validation:{},fields:{password:{rules:"required|lengthBetween:5,16",text:"Password"},passwordConfirmation:{rules:"required|same:password",text:"Repeat password"}},user_id:null,possibleUsers:null}},methods:{send:function(){var e=this;return o()(a.a.mark(function s(){var t;return a.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,e.processing=!0,s.next=4,e.$refs.recaptcha.getToken();case 4:return t=s.sent,s.next=7,e.$apiPost("/user/send-reset-password-email",{email:e.email,recaptcha:t});case 7:e.$notifySuccess("Sent Successfully"),e.sentCount++,s.next=14;break;case 11:throw s.prev=11,s.t0=s.catch(0),s.t0;case 14:return s.prev=14,e.processing=!1,s.finish(14);case 17:case"end":return s.stop()}},s,e,[[0,11,14,17]])}))()},resetPassword:function(){var e=this;this.user_id?Object(i.b)(this.validation).then(function(){var s=o()(a.a.mark(function s(t){var r;return a.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return e.processing=!0,s.next=3,e.$refs.recaptcha.getToken();case 3:return r=s.sent,t.recaptcha=r,t.token=e.$route.query.token,t.user_id=e.user_id,s.next=9,e.$apiPost("/user/reset-password",t);case 9:e.$alert("Reset password successfully. Please login",{callback:function(){var s=e.possibleUsers.find(function(s){return s.id===e.user_id});e.$state.auth.role=s.user_type,e.$state.auth.visible=!0}}),e.processing=!1;case 11:case"end":return s.stop()}},s,e)}));return function(e){return s.apply(this,arguments)}}()).catch(function(s){throw e.processing=!1,s}):this.$alert("Please select your account")}},mounted:function(){var e=this;return o()(a.a.mark(function s(){var t,r,n,o;return a.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!(t=e.$route.query.token)){s.next=19;break}return e.$validate(e.validation,e.fields),r=e.$loading({text:"Checking"}),s.next=6,e.$refs.recaptcha.getToken();case 6:n=s.sent,s.prev=7,o=e.$apiPost("/user/check-reset-password-token",{token:t,recaptcha:n}),e.possibleUsers=o.data,1===e.possibleUsers.length&&(e.user_id=e.possibleUsers[0].id),s.next=16;break;case 13:throw s.prev=13,s.t0=s.catch(7),s.t0;case 16:return s.prev=16,r.close(),s.finish(16);case 19:case"end":return s.stop()}},s,e,[[7,13,16,19]])}))()}},d={render:function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"ResetPassword"},[t("div",{staticClass:"container"},[t("div",{staticClass:"content-card"},[t("div",{staticClass:"text-center"},[t("h1",[e._v("Reset Password")]),e.token?t("form",{staticClass:"_2 ptm"},[t("div",{staticClass:"form-group"},[t("label",[e._v(e._s(e.fields.password.required?"* ":"")+e._s(e.fields.password.text))]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.fields.password.value,expression:"fields.password.value"}],staticClass:"form-control input-lg",attrs:{type:"password"},domProps:{value:e.fields.password.value},on:{input:function(s){s.target.composing||e.$set(e.fields.password,"value",s.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[e._v(e._s(e.fields.passwordConfirmation.required?"* ":"")+e._s(e.fields.passwordConfirmation.text))]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.fields.passwordConfirmation.value,expression:"fields.passwordConfirmation.value"}],staticClass:"form-control input-lg",attrs:{type:"password"},domProps:{value:e.fields.passwordConfirmation.value},on:{input:function(s){s.target.composing||e.$set(e.fields.passwordConfirmation,"value",s.target.value)}}})]),e.possibleUsers&&e.possibleUsers.length>1?t("div",{staticClass:"form-group"},[t("label",[e._v("* Select your account")]),t("UserTable",{attrs:{data:e.possibleUsers},model:{value:e.user_id,callback:function(s){e.user_id=s},expression:"user_id"}})],1):e._e(),t("GoogleRecaptcha",{ref:"recaptcha"}),t("el-button",{staticClass:"btn btn-primary btn-lg btn-block mtm",attrs:{loading:e.processing},on:{click:e.resetPassword}},[e._v("Submit")]),t("br"),t("a",{attrs:{href:"javascript:void(0)"},on:{click:function(s){e.token=null}}},[e._v("Go send reset password email")])],1):[t("div",{staticClass:"_1"},[e.sentCount?t("p",[e._v("Prease check your inbox "),t("i",[t("b",[e._v(e._s(e.email))])]),e._v(" for a reset password email. Clink the link in the email to reset your password.")]):e._e(),t("div",{staticClass:"form-group"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.email,expression:"email"}],staticClass:"form-control input-lg",attrs:{type:"text",placeholder:"Please enter your account email address"},domProps:{value:e.email},on:{input:function(s){s.target.composing||(e.email=s.target.value)}}})])]),t("GoogleRecaptcha",{ref:"recaptcha"}),t("el-button",{staticClass:"btn btn-primary btn-lg",attrs:{loading:e.processing},on:{click:e.send}},[e._v("Send reset password email")])]],2)])])])},staticRenderFns:[]},p=t("8AGX")(u,d,!1,function(e){t("Ye6n")},null,null);s.default=p.exports}});